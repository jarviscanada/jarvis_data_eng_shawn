Table of contents
* [Introduction](#Introduction)
* [Quick Start](#Quick-Start)
* [Architecture](#Architecture)
* [REST API USAGE](#REST-API-Usage)
* [Docker Deployment](#Docker-Deployment)
* [Improvements](#Improvements)

# Introduction
- This is an online stock trading simulation REST API which helps users,traders and front-end developers to view, create and manage traders, accounts, quotes and
security orders. This online simulation trading REST API is built based on a three-tie microservice MVC architecture and using Springboot and maven for dependency management.
It uses IEX Cloud as a data source and PostgreSQL to persist data.
This application can be accessed by various users by consuming REST API through web browser via swagger or by other open source applcations as well like postman.

# Quick Start

### Prequiresites
 *  `CentOS` machine or VM
 *  `Docker`
 *  Minimun `Java 8` version
 *  `Maven`
 *  `IEX Cloud` account for API token
 *  `Swagger` or `postman`
- Start the docker
```$xslt
systemctl status docker || systemctl start docker
```
- Create a new docker network
```$xslt
docker network create --driver bridge trading-net
```
- Build two images, one is for the database, and the other is for the application. build the image at the root directory alone with the Dockerfile

- Create the trading database image
```
cd ./springboot/psql
docker build -t trading-psl .  #docker builds ./Dokcerfile by default
docker image ls -f reference=trading-psl
```
- Create the trading app image
```$xslt
cd ./springboot/
docker build -t trading-app . #docker builds ./Dokcerfile by default
docker image ls -f reference=trading-psl
```
- Create docker container
```$xslt
sudo docker run --name trading-psql-dev \
-e POSTGRES_PASSWORD=password \
-e POSTGRES_DB=jrvstrading \
-e POSTGRES_USER=postgres \
--network trading-net \
-d -p 5432:5432 trading-psql

IEX_PUB_TOKEN="your_token"
#start trading-app container which is attached to the trading-net docker network
sudo docker run --name trading-app-dev \
-e "PSQL_URL=jdbc:postgresql://trading-psql:5432/jrvstrading" \
-e "PSQL_USER=jrvstrading" \
-e "PSQL_PASSWORD=password" \
-e "IEX_PUB_TOKEN=${IEX_PUB_TOKEN}" \
--network trading-net \
-p 8080:8080 -t trading-app
```

### Testing Application with Swagger
Swagger is an open-source software framework backed by a large ecosystem of tools that helps developers design, build, document, and consume RESTful web services. While most users identify Swagger by the Swagger UI tool, the Swagger toolset includes support for automated documentation, code generation, and test-case generation.
To run or consume the application, navigate through `http://localhost:8080/swagger-ui.html#/`
The following page will be shown:  
![Swagger application](/springboot/assets/swagger.jpg)

# Architecture
Each components of the Jarvis Trading REST App:  
![Architecture](/springboot/assets/trading_app_Arch.jpg)

**Controller Layer**: It receives the HTTP request and servlet will map the request to the method in the controller, and the controller is responsible for invoking the corresponding method in the service layer. This application has 4 controllers.    

**Service Layer**: This layer handles the business logic of the application. It verifies if the user
 inputs (e.g. ticker name, trader ID) are correct or not, and calls appropriate methods of the DAO
 classes from the Data Access layer.  

**Data Access Layer** This layer consists of DAO classes which are mainly responsible for data
access in the Postgres database through the DataSource API and in the Iex Cloud through HTTP requests. The DAO (data access object) is designed based on a repository pattern. Each DAO is responsible for one table in the database and uses the model created for its corresponding table.

**Springboot**:It is an open-source framework that consists of Spring MVC features (IOC), auto-configurations and embedded tomcat server. It is best ready to use the micro services platform.	 	

**Database layer** is responsible for data is storage. In this application, PostgreSQL database is used store data generated by the application and the IEX cloud is used as the source of market data. For IEX cloud, this application consumes the IEX cloud REST API and store the parsed data into the PSQL database.

**IEX Cloud**: IEX Cloud is a third party that provides financial data for developers. It gives market data information which is consumed by this application and inturn stores the trader and quote information  into PSQL database.

# REST API Usage
## Swagger
Swagger is an open-source software framework that helps developers design, build, document, and
consume RESTful web services.  Swagger allows one to describe the structure of their APIs so that it
 can automatically build beautiful and interactive API documentation for the API. It can also
 automatically generate client libraries for the API in many languages and explore other
 possibilities like automated testing. It is mainly used for creating interactive documentations for
 RESTful APIs.
## Quote Controller
Quote Controller is responsible for gathering quotes from IEX Cloud and caching them in the
PostgreSQL database. Its endpoints are briefly described below:
- GET `/quote/dailyList`: Lists all securities that are available for trading in this trading
platform.
- GET `/quote/iex/ticker/{ticker}`: Retrieves and shows current quote of given ticker from IEX Cloud.
- POST `/quote/tickerId/{tickerId}`: Saves current quote of given ticker in the quote table of
PostgreSQL database.
- PUT `/quote/`: Updates a quote in the quote table using a provided quote.
- PUT `/quote/iexMarketData`: Updates all the quotes in the quote table using data from IEX Cloud.
## Trader Controller
TraderAccount Controller is responsible for managing the trader and account information. It also
handles the depositing and withdrawal of funds from a given account. Its endpoints are briefly
described below:
- DELETE `/trader/traderId/{traderId}`: Deletes a trader's information (trader table) and their
account (account table), when their ID is provided.
- POST `/trader/`: Creates a trader in the trader table and an associated account with 0 balance in
the account table, when trader information is provided via a DTO.
- POST `/trader/firstname/{firstname}/lastname/{lastname}/dob/{dob}/country/{country}/email/{email}`:
Creates a trader in the trader table and an associated account with 0 balance in the account table,
when trader information is provided via the URL.
- PUT `/trader/deposit/traderId/{traderId}/amount/{fund}`: Manages depositing (adds to account
balance) of a fund, when the fund and the account ID are provided.
- PUT `/trader/withdraw/traderId/{traderId}/amount/{fund}`: Manages withdrawal (subtracts from
account balance) of a fund, when the fund and the account ID are provided.
### Order Controller
Order Controller is responsible for handling market buy/sell orders and updating the security order
table. Its endpoints are briefly described below:
- POST `/order/marketOrder`: Depending on the provided size, ticker and account ID, it submits a
market buy or sell order.

# Docker Deployment
This diagram shows how Docker is used with this application:  
![docker application](/springboot/assets/Trading_App_Docker_Arch.jpg)
- The Jarvis Trading REST App can be dockerized for fast and easy deployment. For this purpose, two Dockerfiles have been created - one for building docker image of the trading application and the other for that of the underlying PostgreSQL database. To make this application run, it is necessary for both of these containers to communicate, the trading network is created. To assemble the images of psql, base image from dockerhub is used and other scripts that  initialise the database. Similarly, to assemble the image of application, used base image of jdk and maven and run my own scripts to package up the application.

# Improvements
- Provide API access for more order types, such as stop and limit orders.
- Increased documentation and code comments.
- Add authentication for security purpose.
- Add dashboard controller.
- Add a cron job to update the quote database from IEX cloud automaticly.
